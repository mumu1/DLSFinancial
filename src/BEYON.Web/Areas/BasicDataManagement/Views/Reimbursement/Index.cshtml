@using BEYON.Domain.Model.App

<div id="content" style="overflow-y: auto; height: 100%; opacity: 1;">
    <div class="content-wrapper">
        <header role="heading">
            <h2>报销事项字典表维护</h2>
        </header>
        <!-- widget div-->

        <div class="jarviswidget jarviswidget-color-darken jarviswidget-sortable" id="wid-id-0" data-widget-editbutton="false" role="widget">
            <!-- widget options:
            usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

            data-widget-colorbutton="false"
            data-widget-editbutton="false"
            data-widget-togglebutton="false"
            data-widget-deletebutton="false"
            data-widget-fullscreenbutton="false"
            data-widget-custombutton="false"
            data-widget-collapsed="true"
            data-widget-sortable="false"

            -->
            <!-- widget div-->
            <div>

                <!-- widget edit box -->
                <div class="jarviswidget-editbox">
                    <!-- This area used as dropdown edit box -->

                </div>
                <!-- end widget edit box -->
                <!-- widget content -->
                <div class="widget-body">
                    <table id="datatable_tabletools" class="table table-striped table-bordered table-hover" width="100%"></table>
                </div>
                <!-- end widget content -->

            </div>
            <!-- end widget div -->
        </div>
        <!-- end widget -->
    </div>

    <div id="importDataDialog"></div>
</div>


<script type="text/javascript">
    $(document).ready(function () {
        loadTableData();

    });
    $("#create_btn").click(function () {

    });
    //加载报销事项列表
    function loadTableData() {
        $.ajax({
            type: "GET",
            url: "../BasicDataManagement/Reimbursement/GetAllData",
            //data: params,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {
                initTable(data);
            },
            error: function () {
                toastr.error('获取报销事项数据失败！');
            }
        });
    }

    function initTable(data) {
        pageSetUp();
        //更新数据
        if ($.fn.dataTable.isDataTable('#datatable_tabletools')) {
            var oSettings = table.fnSettings();
            table.fnClearTable(this);
            for (var i = 0; i < data.rows.length; i++) {
                table.oApi._fnAddData(oSettings, data.rows[i]);
            }

            oSettings.aiDisplay = oSettings.aiDisplayMaster.slice();
            table.fnDraw();
            return;
        }

        var editor = new $.fn.dataTable.Editor({
            "ajaxUrl": {
                "create": "@Url.Action("Create")",
                "edit": "@Url.Action("Edit")",
                "remove": "@Url.Action("Delete")"
            },
            "table": "#datatable_tabletools",
            fields: [{
                label: "科目代码",
                name: "RefundTypeCode"
            }, {
                label: "报销事项:",
                name: "RefundTypeName"
            }
            ]
        });


        table = $('#datatable_tabletools').dataTable({
            dom: 'Bfrtip',
            buttons: [
                {
                    text: "新增", extend: "create", editor: editor
                },
                {
                    text: "修改", extend: "edit", editor: editor, fn: function (editor, dt)
                    {
                        alert('text');
                        var rowData = dt.row({ selected: true }).data();
                        alert(rowData.RefundTypeCode);
                    }
                },
                { text: "删除", extend: "remove", editor: editor },
                {
                    extend: 'collection',
                    text: '导出',
                    buttons: [
                        { text: "拷贝", extend: 'copy' },
                        { text: "EXCEL表格", extend: 'excel' },
                        { text: "CSV表格", extend: 'csv' },
                        { text: "PDF文档", extend: 'pdf' },
                        { text: "打印", extend: 'print' }
                    ]
                },
                {
                    text: "导入",
                    action: function (e, dt, node, config) {
                        var columns = dt.settings().init().columns;
                        dt.columns().every(function (index) {
                            console.log(columns[index].data);
                            console.log(columns[index].title);
                        })

                        $('#importDataDialog').load('../App/Import/ImportData', { url: "@Url.Action("Import")" });
                    }
                },
                {
                    text: "刷新",
                    action: function (e, dt, node, config) {
                        dt.ajax.reload();
                    }
                }
            ],
            searching: true,
            ordering: true,
            select: true,
            info: true,
            paginate: false, //是否显示（应用）分页器
            sort: true, //是否启动各个字段的排序功能
            stateSave: false,
            stateDuration: 60 * 60 * 12,
            autoWidth: true,
            bProcessing: true,
            paging: false,
            columns: [
                                    { data: "Id", title: "编号" },
                                    { data: "RefundTypeCode", title: "科目代码" },
                                    { data: "RefundTypeName", title: "报销事项" }
            ],
            data: data.rows,
            oLanguage: {
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "抱歉， 没有找到",
                "sInfo": "显示 _START_ 到 _END_ 条记录，总共 _TOTAL_ 条记录",
                "sInfoEmpty": "没有数据",
                "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                "sZeroRecords": "没有检索到数据",
                "sSearch": "搜索名称:",
                "sSelected": "选中 _TOTAL_ 条记录",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                }

            }
        });

        //table = $('#datatable_tabletools').dataTable({

        //    // Tabletools options:
        //    //   https://datatables.net/extensions/tabletools/button_options
        //    "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'T>r>" +
        //            "t" +
        //            "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p>>",
        //    "dom": "Bfrtip",
        //    "oTableTools": {
        //        "sRowSelect": "multi",
        //        "aButtons": [
        //            { "sButtonText": "创建", "sExtends": "editor_create", "editor": editor},
        //            { "sButtonText": "修改", "sExtends": "editor_edit", "editor": editor, "bSelectedOnly": true },
        //            { "sButtonText": "删除", "sExtends": "editor_remove", "editor": editor, "bSelectedOnly": true },
        //            { "sButtonText": "另存为Excel", "sExtends": "xls",}
        //        ],
        //        "sSwfPath": "../Scripts/plugin/datatables/swf/copy_csv_xls_pdf.swf"
        //    },
        //    "select": true,
        //    "bPaginate": true, //是否显示（应用）分页器
        //    "bSort": true, //是否启动各个字段的排序功能
        //    "autoWidth": true,
        //    "paging": true,
        //    "aoColumns": [
        //                            { "mDataProp": "Id", "sTitle": "编号" },
        //                            { "mDataProp": "RefundTypeCode", "sTitle": "科目代码" },
        //                            { "mDataProp": "RefundTypeName", "sTitle": "报销事项" }
        //    ],
        //    "data": data.rows,
        //    "oLanguage": {
        //        "sLengthMenu": "每页显示 _MENU_ 条记录",
        //        "sZeroRecords": "抱歉， 没有找到",
        //        "sInfo": "显示 _START_ 到 _END_ 条记录，总共 _TOTAL_ 条记录",
        //        "sInfoEmpty": "没有数据",
        //        "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
        //        "sZeroRecords": "没有检索到数据",
        //        "sSearch": "搜索名称:",
        //        "sSelected": "选中 _TOTAL_ 条记录",
        //        "oPaginate": {
        //            "sFirst": "首页",
        //            "sPrevious": "前一页",
        //            "sNext": "后一页",
        //            "sLast": "尾页"
        //        }

        //    }
        //});

    }


</script>
